<script>
    const apiUrl = 'https://task-manager-hbud.onrender.com';

    async function loadPositions() {
        const response = await fetch(`${apiUrl}/positions`);
        const positions = await response.json();
        const positionSelect = document.getElementById('position');
        positions.forEach(position => {
            const option = document.createElement('option');
            option.value = position.id;
            option.textContent = position.name;
            positionSelect.appendChild(option);
        });
    }

    async function loadEmployees() {
        const response = await fetch(`${apiUrl}/employees/list`);
        const employees = await response.json();
        const tableBody = document.querySelector('#employeesTable tbody');
        tableBody.innerHTML = '';
        employees.forEach(employee => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${employee.id}</td>
                <td>${employee.last_name}</td>
                <td>${employee.first_name}</td>
                <td>${employee.middle_name || ''}</td>
                <td>${employee.phone_number}</td>
                <td>${employee.birth_date}</td>
                <td>${employee.position_name}</td>
                <td>
                    <button onclick="deleteEmployee(${employee.id})">Удалить</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    document.getElementById('employeeForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const lastName = document.getElementById('lastName').value;
        const firstName = document.getElementById('firstName').value;
        const middleName = document.getElementById('middleName').value;
        const phoneNumber = document.getElementById('phoneNumber').value;
        const birthDate = document.getElementById('birthDate').value;
        const password = document.getElementById('password').value;
        const positionId = document.getElementById('position').value;

        const employeeData = {
            last_name: lastName,
            first_name: firstName,
            middle_name: middleName,
            phone_number: phoneNumber,
            birth_date: birthDate,
            password: password,
            position_id: parseInt(positionId)
        };

        await fetch(`${apiUrl}/employees`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(employeeData)
        });

        e.target.reset();
        loadEmployees();
    });

    loadPositions();
    loadEmployees();
</script>
