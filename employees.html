<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</title>
</head>
<body>
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h1>

    <form id="employeeForm">
        <label>–§–∞–º–∏–ª–∏—è:</label>
        <input type="text" id="lastName" required><br>

        <label>–ò–º—è:</label>
        <input type="text" id="firstName" required><br>

        <label>–û—Ç—á–µ—Å—Ç–≤–æ:</label>
        <input type="text" id="middleName"><br>

        <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
        <input type="text" id="phoneNumber" pattern="\d{10}" required><br>

        <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
        <input type="date" id="birthDate" required><br>

        <label>–ü–∞—Ä–æ–ª—å:</label>
        <input type="password" id="password" required><br>

        <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</label>
        <select id="position" required></select><br>

        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>

    <h2>–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
    <table id="employeesTable" border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>–§–∞–º–∏–ª–∏—è</th>
                <th>–ò–º—è</th>
                <th>–û—Ç—á–µ—Å—Ç–≤–æ</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</th>
                <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const apiUrl = 'https://task-manager-hbud.onrender.com';

        async function loadPositions() {
            const response = await fetch(`${apiUrl}/positions`);
            const positions = await response.json();
            const positionSelect = document.getElementById('position');
            positions.forEach(position => {
                const option = document.createElement('option');
                option.value = position.id;
                option.textContent = position.name;
                positionSelect.appendChild(option);
            });
        }

        async function loadEmployees() {
            const response = await fetch(`${apiUrl}/employees/list`);
            const employees = await response.json();
            const tableBody = document.querySelector('#employeesTable tbody');
            tableBody.innerHTML = '';
            employees.forEach(employee => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.id}</td>
                    <td>${employee.last_name}</td>
                    <td>${employee.first_name}</td>
                    <td>${employee.middle_name || ''}</td>
                    <td>${employee.phone_number}</td>
                    <td>${employee.birth_date}</td>
                    <td>${employee.position_name}</td>
                    <td>
                        <button onclick="deleteEmployee(${employee.id})">–£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        document.getElementById('employeeForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö
    const employeeData = {
        last_name: document.getElementById('lastName').value,
        first_name: document.getElementById('firstName').value,
        middle_name: document.getElementById('middleName').value || null, // –î–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        phone_number: document.getElementById('phoneNumber').value,
        birth_date: document.getElementById('birthDate').value,
        password: document.getElementById('password').value,
        position_id: document.getElementById('position').value
    };

    console.log("üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:", employeeData); // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    const response = await fetch('https://task-manager-hbud.onrender.com/employees', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(employeeData)
    });

    const result = await response.json();
    console.log("‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", result); // –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞

    e.target.reset();
    loadEmployees(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
});

    </script>
</body>
</html>
